# =============================================================================
# tmux.conf - Browser-like keybindings with Nord theme
# =============================================================================

# -----------------------------------------------------------------------------
# General Settings
# -----------------------------------------------------------------------------

# Set prefix to Ctrl+B (default, but explicit)
set -g prefix C-b
unbind C-a

# Enable mouse support
set -g mouse on

# Start windows and panes at 1, not 0 (browser-like)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer
set -g history-limit 50000

# Faster key repetition
set -s escape-time 10

# Enable focus events (useful for vim/neovim)
set -g focus-events on

# Set terminal type for proper colors
set -g default-terminal "tmux-256color"
set -as terminal-features ',xterm-256color:RGB'

# Activity monitoring
setw -g monitor-activity off
set -g visual-activity off

# -----------------------------------------------------------------------------
# User-Defined Keys (Custom escape sequences from WezTerm)
# Format: \e[<ascii>;CMD~ for Cmd+key, \e[<ascii>;CMS~ for Cmd+Shift+key
# -----------------------------------------------------------------------------

# Cmd+T: New window
set -s user-keys[0] "\e[84;CMD~"
bind-key -n User0 new-window -c "#{pane_current_path}"

# Cmd+W: Smart close (pane if multiple, window if single pane)
set -s user-keys[1] "\e[87;CMD~"
bind-key -n User1 if-shell '[ #{window_panes} -gt 1 ]' 'kill-pane' 'kill-window'

# Cmd+1-9: Switch to window
set -s user-keys[2] "\e[49;CMD~"
bind-key -n User2 select-window -t 1

set -s user-keys[3] "\e[50;CMD~"
bind-key -n User3 select-window -t 2

set -s user-keys[4] "\e[51;CMD~"
bind-key -n User4 select-window -t 3

set -s user-keys[5] "\e[52;CMD~"
bind-key -n User5 select-window -t 4

set -s user-keys[6] "\e[53;CMD~"
bind-key -n User6 select-window -t 5

set -s user-keys[7] "\e[54;CMD~"
bind-key -n User7 select-window -t 6

set -s user-keys[8] "\e[55;CMD~"
bind-key -n User8 select-window -t 7

set -s user-keys[9] "\e[56;CMD~"
bind-key -n User9 select-window -t 8

set -s user-keys[10] "\e[57;CMD~"
bind-key -n User10 select-window -t 9

# Cmd+Shift+[: Previous window
set -s user-keys[11] "\e[91;CMS~"
bind-key -n User11 previous-window

# Cmd+Shift+]: Next window
set -s user-keys[12] "\e[93;CMS~"
bind-key -n User12 next-window

# Cmd+D: Split pane vertically (right)
set -s user-keys[13] "\e[68;CMD~"
bind-key -n User13 split-window -h -c "#{pane_current_path}"

# Cmd+Shift+D: Split pane horizontally (below)
set -s user-keys[14] "\e[68;CMS~"
bind-key -n User14 split-window -v -c "#{pane_current_path}"

# Cmd+K: Clear scrollback
set -s user-keys[15] "\e[75;CMD~"
bind-key -n User15 send-keys -R \; clear-history

# Cmd+Shift+Left: Select to beginning of line
set -s user-keys[16] "\e[60;CMS~"
bind-key -n User16 copy-mode \; send-keys -X begin-selection \; send-keys -X start-of-line

# Cmd+Shift+Right: Select to end of line
set -s user-keys[17] "\e[62;CMS~"
bind-key -n User17 copy-mode \; send-keys -X begin-selection \; send-keys -X end-of-line

# Option+Shift+Left: Select word backward
set -s user-keys[18] "\e[60;OMS~"
bind-key -n User18 copy-mode \; send-keys -X begin-selection \; send-keys -X previous-word

# Option+Shift+Right: Select word forward
set -s user-keys[19] "\e[62;OMS~"
bind-key -n User19 copy-mode \; send-keys -X begin-selection \; send-keys -X next-word-end

# -----------------------------------------------------------------------------
# Traditional Prefix Bindings (as backup)
# -----------------------------------------------------------------------------

# Reload config
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded!"

# Split panes (traditional)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Pane navigation with vim keys
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane resizing with vim keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Window navigation
bind -r C-h previous-window
bind -r C-l next-window

# Create new window
bind c new-window -c "#{pane_current_path}"

# Swap windows (move tabs left/right)
bind -r < swap-window -t -1\; select-window -t -1
bind -r > swap-window -t +1\; select-window -t +1

# -----------------------------------------------------------------------------
# Copy Mode (vi keys)
# -----------------------------------------------------------------------------

setw -g mode-keys vi
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# Enter copy mode
bind [ copy-mode
bind -n PageUp copy-mode -u

# -----------------------------------------------------------------------------
# Status Bar - Tab-like Appearance
# -----------------------------------------------------------------------------

# Status bar position
set -g status-position bottom

# Status bar update interval
set -g status-interval 1

# Status bar justification
set -g status-justify left

# Load Nord theme
source-file ~/.config/tmux/nord-theme.conf
